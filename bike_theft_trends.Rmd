---
title: "How Bike Theft Trends in Toronto Have Changed Over Time"
subtitle: "And How Cyclists Can Keep Their Bikes Safe"
author: "Ricky Yuen, Xinyi Zhang"
date: "3/5/2021"
output: pdf_document
---

```{r setup, include=FALSE}
# don't show code in data-driven article
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

```{r}
# set up libraries and load data
library(ggmap)
library(ggplot2)
library(tidyverse)
library(latticeExtra)

data <- read.csv("bicycle-thefts-2014-2019.csv")
```

```{r}
data_recovered <- data %>% group_by(Status) %>%
  summarise(count=n())
```


# Introduction
In August of 2020, a group of bike thieves made headlines when they were caught on video attempting to steal several bikes from a gated garage in downtown Toronto using a power saw. 11 months earlier, a thief was filmed cutting off the lock of a $1500 bike in Toronto's financial district in broad daylight. Unfortunately, videos like these capture only a small proportion of the bike thefts that occur in Toronto every year. According to the bike theft reports released by the Toronto Police Service, over 21,500 bikes have been stolen from 2014 to 2019. Unfortunately, only around 1% of those bikes have been recovered. 

In this article, we will analyze the aforementioned bike theft reports to explore how bike theft trends have changed over time. Cyclists can leverage the patterns we have identified to assess and minimize their risk of becoming a victim of bike theft.

# How have bike theft numbers changed over the past few years at the monthly level?
```{r}
data$Cost_of_Bike[is.na(data$Cost_of_Bike)] <- 0
data_month <- data %>%
  group_by(Occurrence_Year, Occurrence_Month) %>%
  summarise(frequency=n(), cost=sum(Cost_of_Bike))
data_month$Occurrence_Date <- zoo::as.yearmon(paste(data_month$Occurrence_Year, data_month$Occurrence_Month), "%Y %m")
months <- c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12)
temps <- c(-3.5, -3, -1.5, 7.5, 16.5, 19.5, 23, 22, 18, 23, 5, 0)
data_month <- data_month %>% mutate(Temperature=plyr::mapvalues(Occurrence_Month, months, temps))
```

```{r}
ggplot(data=data_month) + 
  geom_line(aes(x=Occurrence_Date, y=frequency, color=Temperature)) +
  geom_point(aes(x=Occurrence_Date, y=frequency, color=Temperature)) + 
  scale_color_gradient(low="blue4", high="red3") +
  labs(x="Date",
       y="Number of Thefts") + 
  theme_minimal()
```
After grouping bike thefts by month, the most noticeable pattern that emerges is the cyclic trend between the seasons and theft counts. In the winter when temperatures often fall below freezing, bike theft counts drop to their lowest counts (generally, falling below 100 thefts). On the other hand, in the summer, bike theft counts reach their peak with typically over 500 thefts in the warmest months of the year. 

This seasonal pattern makes sense considering that cyclists are more likely to regularly bike when the weather is warm. This in turn affords bike thieves more opportunities to spot and steal bikes during the summer months compared to the winter months. In fact, our analysis indicates that over 5 times the number of bikes stolen in the winter will be stolen in the summer of that year. Therefore, cyclists should strive to be extra vigilant when storing and locking up their bikes in the summer.

We can also observe that as the years progress, the number of thefts appear to increase during both the summer and winter months. Therefore, we'd like to determine how bike thefts numbers in Toronto have changed over time when weather isn't a factor. 

# How have bike theft numbers changed at the yearly level?
```{r}
data_year <- data_month %>%
  group_by(Occurrence_Year) %>%
  summarise(frequency=sum(frequency),
            cost=sum(cost)) %>%
  mutate(cost = cost/1000000)

obj1 <- xyplot(frequency ~ Occurrence_Year, data_year, type="l", xlab="Year", ylab="Number of Thefts")
obj2 <- xyplot(cost ~ Occurrence_Year, data_year, type="l", 
               xlab="Year", ylab="Cost (in Millions)",
               col="forestgreen")
update(doubleYScale(obj1, obj2, add.ylab2 = TRUE),
  par.settings = simpleTheme(col = c('dodgerblue3','forestgreen')))
```
By aggregating bike theft counts over the course of each year (displayed in blue), we can focus on how the frequency of this crime has changed since 2014. From our visualization, we can easily notice that the number of bike thefts has steadily increased for each year between 2014 and 2018. The largest increase occurred between 2015 and 2016 which saw 15% jump in stolen bikes,  This trend was broken in 2019 as the only year that saw a decrease in the number of bikes thefts. 

Interestingly, although the number of bike thefts decreased in 2019, 

Money




- bike purchase
- risk assessment
- if and how they changed over time
- bike features and risk factors associated with bike theft
story
- clear sections with meaningful section headers
- for each visualization: what question the visualization addresses
  - what the reader should see that is useful/interesting for understanding the story
  - how its analysis leads to new question and the visualization that follows
- summarize main finding and actionable insights

- trends over months and years
- costs over time

- time of day 
Therefore, our visualization suggests that cyclists should consider storing their bikes overnight as securely as they do during the if possible.

```{r}
data_hourly <- data %>% mutate(Hour = lubridate::hour(Occurrence_Time)) %>%
  group_by(Hour) %>%
  summarise(frequency=n())

data_hourly %>% ggplot(aes(x=Hour, y=frequency)) +
  geom_line()
```
- type, make, speed, color
```{r}
data_makes <- data %>% group_by(Bike_Make) %>%
  summarise(frequency=n())
```


```{r}
data_bike <- data %>% filter(Cost_of_Bike > 0) %>%
  filter(Cost_of_Bike < 25000) %>%
  mutate(Bike_Type=str_replace(Bike_Type, "BM", "Off-Road")) %>%
  mutate(Bike_Type=str_replace(Bike_Type, "EL", "Electric")) %>%
  mutate(Bike_Type=str_replace(Bike_Type, "FO", "Road")) %>%
  mutate(Bike_Type=str_replace(Bike_Type, "MT", "Off-Road")) %>%
  mutate(Bike_Type=str_replace(Bike_Type, "OT", "Other")) %>%
  mutate(Bike_Type=str_replace(Bike_Type, "RC", "Road")) %>%
  mutate(Bike_Type=str_replace(Bike_Type, "RE", "Other")) %>%
  mutate(Bike_Type=str_replace(Bike_Type, "RG", "Road")) %>%
  mutate(Bike_Type=str_replace(Bike_Type, "SC", "Other")) %>%
  mutate(Bike_Type=str_replace(Bike_Type, "TA", "Road")) %>%
  mutate(Bike_Type=str_replace(Bike_Type, "TO", "Road")) %>%
  mutate(Bike_Type=str_replace(Bike_Type, "TR", "Road")) %>%
  mutate(Bike_Type=str_replace(Bike_Type, "UN", "Road")) %>%
  mutate(Bike_Make=str_trim(Bike_Make))
bike_makes <- c("GI", "GIANT", "TR", "TREK", "NO", "NORCO", "CC", "CCM",
                "SE", "SPECIALIZED", "SC", "SCHWINN", "CA", "CANNONDALE", 
                "RA", "RALEIGH", "SU", "SUPERCYCLE", "KO", "KONA")
data_bike <- data_bike %>% filter(Bike_Make %in% bike_makes) %>%
  mutate(Bike_Make=str_replace(Bike_Make, "GI$", "Giant")) %>%
  mutate(Bike_Make=str_replace(Bike_Make, "GIANT", "Giant")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "TR$", "Trek")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "TREK", "Trek")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "NO$", "Norco")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "NORCO", "Norco")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "CC$", "CCM")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "SE$", "Specialized")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "SPECIALIZED", "Specialized")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "SC$", "Schwinn")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "SCHWINN", "Schwinn")) %>%
  mutate(Bike_Make=str_replace(Bike_Make, "CA$", "Cannondale")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "CANNONDALE", "Cannondale")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "RA$", "Raleigh")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "RALEIGH", "Raleigh")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "SU$", "Supercycle")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "SUPERCYCLE", "Supercycle")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "KO$", "Kona")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "KONA", "Kona")) 

data_bike_2 <- data_bike %>% group_by(Bike_Make) %>%
  summarise(frequency=n())

data_bike %>% ggplot(aes(y=Bike_Make, x=Cost_of_Bike)) +
  geom_point(aes(color=Bike_Type), alpha=0.25, position="jitter")
```


- location of theft
```{r}
data_premise <- data %>%
  filter(Premise_Type != "Other")

data_premise <- data_premise %>%
  group_by(Occurrence_Year, Premise_Type) %>%
  summarise(frequency=n())

data_premise %>% ggplot(aes(x=Occurrence_Year, y=frequency, fill=Premise_Type)) +
  geom_bar(stat="identity")

```

- location of most thefts

- density map of stolen bikes
- location of thefts

```{r, message=FALSE}
data <- read.csv("bicycle-thefts-2014-2019.csv")

map <- qmplot(Long, Lat, data=data, maptype="toner", geom="blank", 
              xlab="Longitude", ylab="Latitude")

map + geom_point(alpha=0.2, colour="red")
```
```{r}
map + stat_density2d(aes(fill=..level..), geom="polygon", alpha=.5) +
  scale_fill_viridis_c()
```

- most stolen bike make
```{r}
makes <- plyr::count(data, "Bike_Make")
sorted_makes <- makes[order(-makes$freq),]
sorted_makes$Bike_Make <- gsub("^OT\\s", "OTHER", sorted_makes$Bike_Make)
sorted_makes$Bike_Make <- gsub("^UK\\s", "UNKNOWN MAKE", sorted_makes$Bike_Make)
sorted_makes$Bike_Make <- gsub("^TR\\s", "TREK", sorted_makes$Bike_Make)
sorted_makes$Bike_Make <- gsub("^NO\\s", "NORCO", sorted_makes$Bike_Make)
sorted_makes$Bike_Make <- gsub("^CC\\s", "CCM", sorted_makes$Bike_Make)
sorted_makes$Bike_Make <- gsub("^GI\\s", "GIANT", sorted_makes$Bike_Make)
sorted_makes$Bike_Make <- gsub("^SC\\s", "SCHWINN", sorted_makes$Bike_Make)
sorted_makes$Bike_Make <- gsub("^CA\\s", "CANNONDALE", sorted_makes$Bike_Make)
sorted_makes$Bike_Make <- gsub("^KO\\s", "KONA", sorted_makes$Bike_Make)
sorted_makes$Bike_Make <- gsub("^RA\\s", "RALEIGH", sorted_makes$Bike_Make)
sorted_makes$Bike_Make <- gsub("^SU\\s", "SUPERCYCLE", sorted_makes$Bike_Make)
sorted_makes$Bike_Make <- gsub("\\s*$", "", sorted_makes$Bike_Make)

sorted_makes <- plyr::count(sorted_makes, "Bike_Make")
sorted_makes <- sorted_makes[order(-sorted_makes$freq),]
sorted_makes <- sorted_makes[3:12,]

ggplot(sorted_makes, aes(Bike_Make, freq)) + geom_bar(stat="identity") +
  xlab("Bike Make") + ylab("Number of Bikes Stolen") +
  scale_x_discrete(guide = guide_axis(n.dodge=2)) + theme_bw()
```
- Which neighbourhood had the most bikes stolen from

```{r}
neighbourhood <- plyr::count(data, "Neighbourhood")
sorted_neighbourhood <- neighbourhood[order(-neighbourhood$freq),]
ggplot(sorted_neighbourhood[1:10,], aes(Neighbourhood, freq)) + 
  geom_bar(stat="identity") + theme(axis.text.x = element_text(angle = 15)) + 
  ylab("Number of Bikes Stolen")
```

# References
https://toronto.ctvnews.ca/my-jaw-dropped-attempted-bike-theft-by-power-saw-wielding-suspects-caught-on-camera-1.5080725#:~:text=According%20to%20Toronto%20police%20data,bikes%20have%20been%20reported%20recovered.&text=Topping%20the%20list%20are%20communities,cases%20were%20reported%20to%20police.

https://www.cbc.ca/news/canada/toronto/brazen-daylight-bike-theft-1.5272602

https://www.currentresults.com/Weather/Canada/Ontario/Places/toronto-temperatures-by-month-average.php
