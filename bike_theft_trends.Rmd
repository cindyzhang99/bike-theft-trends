---
title: "How Bike Theft Trends in Toronto Have Changed Over Time"
subtitle: "And How Cyclists Can Keep Their Bikes Safe"
author: "Ricky Yuen, Xinyi Zhang"
date: "3/5/2021"
output: pdf_document
---

```{r setup, include=FALSE}
# don't show code in data-driven article
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

```{r}
# set up libraries and load data
library(ggmap)
library(ggplot2)
library(tidyverse)
library(latticeExtra)

data <- read.csv("bicycle-thefts-2014-2019.csv")
```

```{r}
data_recovered <- data %>% group_by(Status) %>%
  summarise(count=n())
```


# Introduction
In August of 2020, a group of bike thieves made headlines when they were caught on video attempting to steal several bikes from a gated garage in downtown Toronto using a power saw. 11 months earlier, a thief was filmed cutting off the lock of a $1500 bike in Toronto's financial district in broad daylight. Unfortunately, videos like these capture only a small proportion of the bike thefts that occur in Toronto every year. According to the bike theft reports released by the Toronto Police Service, over 21,500 bikes have been stolen from 2014 to 2019. Unfortunately, only around 1% of those bikes have been recovered. 

In this article, we will analyze the aforementioned bike theft reports to explore how bike theft trends have changed over time. Cyclists can leverage the patterns we have identified to assess and minimize their risk of becoming a victim of bike theft.

# How have the number of bike thefts changed over time?
```{r}
data$Cost_of_Bike[is.na(data$Cost_of_Bike)] <- 0
data_month <- data %>%
  group_by(Occurrence_Year, Occurrence_Month) %>%
  summarise(frequency=n(), cost=sum(Cost_of_Bike))
data_month$Occurrence_Date <- zoo::as.yearmon(paste(data_month$Occurrence_Year, data_month$Occurrence_Month), "%Y %m")
```

```{r}
ggplot(data=data_month) + 
  geom_line(aes(x=Occurrence_Date, y=frequency)) +
  geom_point(aes(x=Occurrence_Date, y=frequency))
```
```{r}
data_year <- data_month %>%
  group_by(Occurrence_Year) %>%
  summarise(frequency=sum(frequency),
            cost=sum(cost))

obj1 <- xyplot(frequency ~ Occurrence_Year, data_year, type="l")
obj2 <- xyplot(cost ~ Occurrence_Year, data_year, type="l")
doubleYScale(obj1, obj2, text=c("Frequency", "Cost"), add.ylab2 = TRUE)
```
- bike purchase
- risk assessment
- if and how they changed over time
- bike features and risk factors associated with bike theft
story
- clear sections with meaningful section headers
- for each visualization: what question the visualization addresses
  - what the reader should see that is useful/interesting for understanding the story
  - how its analysis leads to new question and the visualization that follows
- summarize main finding and actionable insights

- trends over months and years
- costs over time

- primary offense over time
```{r}
data_offense <- data %>%
  filter(str_detect(Primary_Offence, "THEFT") | str_detect(Primary_Offence, "B&E")) %>%
  mutate(Primary_Offence=str_replace(Primary_Offence, "THEFT.*", "Theft")) %>%
  mutate(Primary_Offence=str_replace(Primary_Offence, "B&E.*", "B&E"))

data_offense <- data_offense %>%
  group_by(Occurrence_Year, Primary_Offence) %>%
  summarise(frequency=n())

data_offense %>% ggplot(aes(x=Occurrence_Year, y=frequency, fill=Primary_Offence)) +
  geom_bar(stat="identity")
```
- time of day 

```{r}
data_hourly <- data %>% mutate(Hour = lubridate::hour(Occurrence_Time)) %>%
  group_by(Hour) %>%
  summarise(frequency=n())

data_hourly %>% ggplot(aes(x=Hour, y=frequency)) +
  geom_line()
```
- type, make, speed, color
```{r}
data_makes <- data %>% group_by(Bike_Make) %>%
  summarise(frequency=n())
```


```{r}
data_bike <- data %>% filter(Cost_of_Bike > 0) %>%
  filter(Cost_of_Bike < 25000) %>%
  mutate(Bike_Type=str_replace(Bike_Type, "BM", "Off-Road")) %>%
  mutate(Bike_Type=str_replace(Bike_Type, "EL", "Electric")) %>%
  mutate(Bike_Type=str_replace(Bike_Type, "FO", "Road")) %>%
  mutate(Bike_Type=str_replace(Bike_Type, "MT", "Off-Road")) %>%
  mutate(Bike_Type=str_replace(Bike_Type, "OT", "Other")) %>%
  mutate(Bike_Type=str_replace(Bike_Type, "RC", "Road")) %>%
  mutate(Bike_Type=str_replace(Bike_Type, "RE", "Other")) %>%
  mutate(Bike_Type=str_replace(Bike_Type, "RG", "Road")) %>%
  mutate(Bike_Type=str_replace(Bike_Type, "SC", "Other")) %>%
  mutate(Bike_Type=str_replace(Bike_Type, "TA", "Road")) %>%
  mutate(Bike_Type=str_replace(Bike_Type, "TO", "Road")) %>%
  mutate(Bike_Type=str_replace(Bike_Type, "TR", "Road")) %>%
  mutate(Bike_Type=str_replace(Bike_Type, "UN", "Road")) %>%
  mutate(Bike_Make=str_trim(Bike_Make))
bike_makes <- c("GI", "GIANT", "TR", "TREK", "NO", "NORCO", "CC", "CCM",
                "SE", "SPECIALIZED", "SC", "SCHWINN", "CA", "CANNONDALE", 
                "RA", "RALEIGH", "SU", "SUPERCYCLE", "KO", "KONA")
data_bike <- data_bike %>% filter(Bike_Make %in% bike_makes) %>%
  mutate(Bike_Make=str_replace(Bike_Make, "GI$", "Giant")) %>%
  mutate(Bike_Make=str_replace(Bike_Make, "GIANT", "Giant")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "TR$", "Trek")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "TREK", "Trek")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "NO$", "Norco")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "NORCO", "Norco")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "CC$", "CCM")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "SE$", "Specialized")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "SPECIALIZED", "Specialized")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "SC$", "Schwinn")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "SCHWINN", "Schwinn")) %>%
  mutate(Bike_Make=str_replace(Bike_Make, "CA$", "Cannondale")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "CANNONDALE", "Cannondale")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "RA$", "Raleigh")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "RALEIGH", "Raleigh")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "SU$", "Supercycle")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "SUPERCYCLE", "Supercycle")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "KO$", "Kona")) %>% 
  mutate(Bike_Make=str_replace(Bike_Make, "KONA", "Kona")) 

data_bike_2 <- data_bike %>% group_by(Bike_Make) %>%
  summarise(frequency=n())

data_bike %>% ggplot(aes(y=Bike_Make, x=Cost_of_Bike)) +
  geom_point(aes(color=Bike_Type), alpha=0.25, position="jitter")
```


- location of theft
```{r}
data_premise <- data %>%
  filter(Premise_Type != "Other")

data_premise <- data_premise %>%
  group_by(Occurrence_Year, Premise_Type) %>%
  summarise(frequency=n())

data_premise %>% ggplot(aes(x=Occurrence_Year, y=frequency, fill=Premise_Type)) +
  geom_bar(stat="identity")

```

- location of most thefts

- density map of stolen bikes
- location of thefts

```{r, message=FALSE}
data <- read.csv("bicycle-thefts-2014-2019.csv")

map <- qmplot(Long, Lat, data=data, maptype="toner", geom="blank", 
              xlab="Longitude", ylab="Latitude")

map + geom_point(alpha=0.2, colour="red")
```
```{r}
map + stat_density2d(aes(fill=..level..), geom="polygon", alpha=.5) +
  scale_fill_viridis_c()
```

- most stolen bike make
```{r}
makes <- plyr::count(data, "Bike_Make")
sorted_makes <- makes[order(-makes$freq),]
sorted_makes$Bike_Make <- gsub("^OT\\s", "OTHER", sorted_makes$Bike_Make)
sorted_makes$Bike_Make <- gsub("^UK\\s", "UNKNOWN MAKE", sorted_makes$Bike_Make)
sorted_makes$Bike_Make <- gsub("^TR\\s", "TREK", sorted_makes$Bike_Make)
sorted_makes$Bike_Make <- gsub("^NO\\s", "NORCO", sorted_makes$Bike_Make)
sorted_makes$Bike_Make <- gsub("^CC\\s", "CCM", sorted_makes$Bike_Make)
sorted_makes$Bike_Make <- gsub("^GI\\s", "GIANT", sorted_makes$Bike_Make)
sorted_makes$Bike_Make <- gsub("^SC\\s", "SCHWINN", sorted_makes$Bike_Make)
sorted_makes$Bike_Make <- gsub("^CA\\s", "CANNONDALE", sorted_makes$Bike_Make)
sorted_makes$Bike_Make <- gsub("^KO\\s", "KONA", sorted_makes$Bike_Make)
sorted_makes$Bike_Make <- gsub("^RA\\s", "RALEIGH", sorted_makes$Bike_Make)
sorted_makes$Bike_Make <- gsub("^SU\\s", "SUPERCYCLE", sorted_makes$Bike_Make)
sorted_makes$Bike_Make <- gsub("\\s*$", "", sorted_makes$Bike_Make)

sorted_makes <- plyr::count(sorted_makes, "Bike_Make")
sorted_makes <- sorted_makes[order(-sorted_makes$freq),]
sorted_makes <- sorted_makes[3:12,]

ggplot(sorted_makes, aes(Bike_Make, freq)) + geom_bar(stat="identity") +
  xlab("Bike Make") + ylab("Number of Bikes Stolen") +
  scale_x_discrete(guide = guide_axis(n.dodge=2)) + theme_bw()
```
- Which neighbourhood had the most bikes stolen from

```{r}
neighbourhood <- plyr::count(data, "Neighbourhood")
sorted_neighbourhood <- neighbourhood[order(-neighbourhood$freq),]
ggplot(sorted_neighbourhood[1:10,], aes(Neighbourhood, freq)) + 
  geom_bar(stat="identity") + theme(axis.text.x = element_text(angle = 15)) + 
  ylab("Number of Bikes Stolen")
```
- Month and Year vs Number of Bikes stolen

```{r}
times <- plyr::count(data, "Occurrence_Date")

times$Occurrence_Date <- gsub("\\s.*$", "", times$Occurrence_Date) 

dates <- c(sprintf("2014/0%d/01",seq(01:12)),
           sprintf("2015/0%d/01",seq(01:12)),
           sprintf("2016/0%d/01",seq(01:12)),
           sprintf("2017/0%d/01",seq(01:12)),
           sprintf("2018/0%d/01",seq(01:12)),
           sprintf("2019/0%d/01",seq(01:12)))
dates <- gsub("/010/", "/10/", dates)
dates <- gsub("/011/", "/11/", dates)
dates <- gsub("/012/", "/12/", dates)

months <- c("Jan","Feb","Mar",
            "Apr","May","Jun",
            "Jul","Aug","Sep",
            "Oct","Nov","Dec")

date_lab <- c(months, months, months, months, months, months)

ggplot(times, aes(Occurrence_Date, freq)) + geom_point() + 
  scale_x_discrete(breaks=dates, labels=date_lab) + theme_bw() +
theme(axis.text.x = element_text(angle = 90)) + xlab("Month") + ylab("Number of Stolen Bikes") + 
  annotate("text", x = "2014/07/01", y = 0, label = "2014") + 
  annotate("text", x = "2015/07/01", y = 0, label = "2015") + 
  annotate("text", x = "2016/07/01", y = 0, label = "2016") + 
  annotate("text", x = "2017/07/01", y = 0, label = "2017") + 
  annotate("text", x = "2018/07/01", y = 0, label = "2018") + 
  annotate("text", x = "2019/07/01", y = 0, label = "2019")
```

# References
https://toronto.ctvnews.ca/my-jaw-dropped-attempted-bike-theft-by-power-saw-wielding-suspects-caught-on-camera-1.5080725#:~:text=According%20to%20Toronto%20police%20data,bikes%20have%20been%20reported%20recovered.&text=Topping%20the%20list%20are%20communities,cases%20were%20reported%20to%20police.

https://www.cbc.ca/news/canada/toronto/brazen-daylight-bike-theft-1.5272602
